<html>
<body>
<script>
(function(){
	var split = function*(pattern){
		var match, currentPart = "", level = 0, rgx = /[^{}]+|[{}]/g;
		while((match = rgx.exec(pattern)) && (match = match[0])){
			if(match == "{"){
				if(currentPart && level == 0){
					yield currentPart;
					currentPart = "";
				}
				currentPart += match;
				level++;
			}else if(match == "}"){
				currentPart += match;
				level--;
				if(level == 0){
					yield currentPart;
					currentPart = "";
				}
			}else{
				currentPart += match;
			}
		}
		if(currentPart){
			yield currentPart;
		}
	};
	var product = function(...iterables){
		return function*(...things){
			for(let one of iterables){
				one = [...one];
				for(let two of things){
					yield (function*(){
						for(let ofOne of one){
							yield ofOne;
						}
						yield two;
					})();
				}
			}
		};
	};
	var productOfMany = function(...iterables){
		var result, first = true;
		for(let it of iterables){
			if(first){
				result = (function*(){for(let ofIt of it){yield [ofIt];}})();
				first = false;
			}else{
				result = product(...result)(...it);
			}
		}
		return result;
	};
	var splitOnCommas = function(list){
		var segments = [], parts = split(list);
		for(let part of parts){
			if(part.match(/^[^{}]+$/)){
				segments = segments.concat(part.split(","));
			}else{
				segments.push((segments.pop() || "") + part);
			}
		}
		return segments;
	};
	var possibilities = function*(pattern){
		var parts = split(pattern);
		for(let part of parts){
			if(part.match(/^[^{}]+$/)){
				yield [part];
			}else{
				//yield getList(part.substr(1,part.length - 2));
			}
		}
	};
	console.log(splitOnCommas("een,twee{drie,vier}vijf"));
	//console.log([...possibilities("dat is {,ook} {wel,niet{, erg}} leuk")]);
	//console.log([...productOfMany(["dat is "],["","ook"],[" "],["wel","niet","niet erg"],[" leuk"])].map(function(x){return [...x].join("");}));
	//console.log([...split("dat is {,ook} {wel,niet{, erg}} leuk")]);
})();
</script>
</body>
</html>