<html>
<body>
	<script src="test.js"></script>
<script>
(function(){
	//---------- https://www.codewars.com/kata/brace-expansion ---------------
	var split = function*(pattern){
		var match, currentPart = "", level = 0, rgx = /[^{}]+|[{}]/g;
		while((match = rgx.exec(pattern)) && (match = match[0])){
			if(match == "{"){
				if(currentPart && level == 0){
					yield currentPart;
					currentPart = "";
				}
				currentPart += match;
				level++;
			}else if(match == "}"){
				currentPart += match;
				level--;
				if(level == 0){
					yield currentPart;
					currentPart = "";
				}
			}else{
				currentPart += match;
			}
		}
		if(currentPart){
			yield currentPart;
		}
	};
	var product = function(...iterables){
		return function*(...things){
			for(let one of iterables){
				one = [...one];
				for(let two of things){
					yield (function*(){
						for(let ofOne of one){
							yield ofOne;
						}
						yield two;
					})();
				}
			}
		};
	};
	var productOfMany = function(...iterables){
		var result, first = true;
		for(let it of iterables){
			if(first){
				result = (function*(){for(let ofIt of it){yield [ofIt];}})();
				first = false;
			}else{
				result = product(...result)(...it);
			}
		}
		return result;
	};
	var splitOnCommas = function*(list){
		var current = "", parts = split(list);
		for(var part of parts){
			if(part.match(/^[^{}]+$/)){
				var subParts = part.match(/[^,]+|,/g);
				for(var subPart of subParts){
					if(subPart == ","){
						yield current;
						current = "";
					}else{
						current += subPart;
					}
				}
			}else{
				current += part;
			}
		}
		yield current;
	};
	var getList = function*(partWithinBraces){
		var parts = splitOnCommas(partWithinBraces);
		for(let part of parts){
			if(part.match(/^[^{}]*$/)){
				yield part;
			}else{
				var expanded = expand(part);
				for(let subPart of expanded){
					yield subPart;
				}
			}
		}
	};
	var possibilities = function*(pattern){
		var parts = split(pattern);
		for(let part of parts){
			if(part.match(/^[^{}]*$/)){
				yield [part];
			}else{
				yield getList(part.substr(1,part.length - 2));
			}
		}
	};
	var expand = function(pattern){
		return [...productOfMany(...possibilities(pattern))].map(function(x){return [...x].join("");});
	};
	//console.log(expand("~/{Downloads,Pictures}/*.{jpg,gif,png}"));
	
	//---------- https://www.codewars.com/kata/number-of-proper-fractions-with-denominator-d ---------------

	var factors = function*(n){
		var left = n, current = 2;
		while(left > 1 && current < n){
			if(left % current == 0){
				yield current;
				left = left / current;
			}else{
				current++;
			}
		}
	}
	var distinct = function*(numbers){
		var previous, current;
		for(current of numbers){
			if(current != previous){
				previous = current;
				yield current;
			}
		}
	};
	
	var properFractionsLimited = function(n, limit){
		var highestFactor = 0, result = n, foundFactor = false;
		for(var factor of distinct(factors(n))){
			if(factor > limit){
				break;
			}
			foundFactor = true;
			result -= properFractionsLimited(n / factor, highestFactor);
			highestFactor = factor;
		}
		return result - 1;
	};
	var properFractions = function(n){
		return properFractionsLimited(n, n);
	};
	Test.assertEquals(properFractions(1),0);
	Test.assertEquals(properFractions(2),1);
	Test.assertEquals(properFractions(5),4);
	Test.assertEquals(properFractions(15),8);
	Test.assertEquals(properFractions(25),20);
	Test.assertEquals(properFractions(30),8);
})();
</script>
</body>
</html>